<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xml:lang="en" lang="en">

<f:metadata>
    <f:viewParam name="id" value="#{articleController.articleId}"/>
    <f:event listener="#{articleController.init}" type="preRenderView"/>
</f:metadata>

<ui:composition template="templates/templ.xhtml">
    <ui:define name="pageContent">
        <div class="pageTitle">
            #{userController.currentUser.firstName}'s shopping cart
        </div>
        <h:form>
            <p:wizard flowListener="#{flowBean.onFlowProcess}">
                <p:tab id="review" title="Review your order">
                    <p:panel>
                        <div style="max-width: 60%; margin: 10px auto;">
                            <p:dataList var="line" value="#{orderController.currentOrder.orderLines}"
                                        emptyMessage="There are no items in your shopping cart."
                                        type="ordered">
                                <h:outputText value="#{line.article.title}" class="titleColumn"/><br/>
                                <div class="ui-g">
                                    <div class="ui-g-1">#{line.amount}</div>
                                    <div class="ui-g-1">x</div>
                                    <div class="ui-g-2">#{line.article.price}€</div>
                                    <div class="ui-g-4 rightAlign">=</div>
                                    <div class="ui-g-2 rightAlign">
                                        <h:outputText value="#{line.subTotal}">
                                            <f:convertNumber pattern="0.00 €"/>
                                        </h:outputText>
                                    </div>
                                    <div class="ui-g-1">
                                        <p:commandLink styleClass="removeLink"
                                                       action="#{orderController.deleteOrderLine(line)}"
                                                       update="@form">
                                            <i class="far fa-trash-alt deleteArticle"></i>
                                        </p:commandLink>
                                    </div>
                                    <div class="ui-g-1">
                                        <p:commandLink id="changeAmount" styleClass="removeLink" update="@form">
                                            <i class="fas fa-pencil-alt editArticle"></i>
                                        </p:commandLink>
                                        <p:overlayPanel for="changeAmount" hideEffect="fade">
                                            <p:panelGrid columns="2" cellSpacing="5">
                                                <!-- TODO: change amount knop -> action??  -->
                                                <p:commandButton value="Change amount"
                                                                 update="@form"
                                                                 style="max-width: 20px;"/>
                                                <p:spinner id="amount"
                                                           value="#{orderController.currentOrder.orderLines.get(line.id).amount}"
                                                           min="1"
                                                           max="20"
                                                           immediate="true"/>
                                            </p:panelGrid>
                                        </p:overlayPanel>
                                    </div>
                                </div>
                            </p:dataList>
                            <p:separator/>
                            <div class="ui-g">
                                <div class="ui-g-6">Total price</div>
                                <div class="ui-g-4 rightAlign titleColumn">
                                    <h:outputText value="#{orderController.currentOrder.price}">
                                        <f:convertNumber pattern="0.00 €"/>
                                    </h:outputText>
                                </div>
                                <div class="ui-g-2"></div>
                            </div>
                        </div>
                    </p:panel>
                </p:tab>
                <p:tab id="payment" title="Payment">
                    <p:panel>
                        <div style="max-width: 60%; margin: 10px auto;">
                            <p:panel header="Enter credit card information">
                                <h:selectOneRadio id="paymentMethods">
                                    <div class="ui-g">
                                        <div class="ui-g-4">
                                            <h:outputLabel for="visa">
                                                <h:graphicImage value="/images/payment/cards-visa.png"/>
                                            </h:outputLabel>
                                            <f:selectItem id="visa" itemValue="visa"/>
                                        </div>

                                        <div class="ui-g-4">
                                            <h:outputLabel for="mc">
                                                <h:graphicImage value="/images/payment/cards-mc.png"/>
                                            </h:outputLabel>
                                            <f:selectItem id="mc" itemValue="mc"/>
                                        </div>

                                        <div class="ui-g-4">
                                            <h:outputLabel for="amex">
                                                <h:graphicImage value="/images/payment/cards-amex.png"/>
                                            </h:outputLabel>
                                            <f:selectItem id="amex" itemValue="amex"/>
                                        </div>
                                    </div>
                                </h:selectOneRadio>

                                <p:panelGrid columns="2" cellPadding="5">
                                    <p:outputLabel for="cardNumber" value="Credit card number"/>
                                    <p:inputMask id="cardNumber"
                                                 mask="9999-9999-9999-9999"
                                                 required="true"/>

                                    <p:outputLabel for="expMonth" value="Expiration month"/>
                                    <p:selectOneMenu id="expMonth">
                                        <f:selectItems value="#{flowBean.months}"
                                                       var="year"
                                                       itemLabel="#{year}"/>
                                    </p:selectOneMenu>

                                    <p:outputLabel for="expYear" value="Expiration year"/>
                                    <p:selectOneMenu id="expYear">
                                        <f:selectItems value="#{flowBean.years}"
                                                       var="year"
                                                       itemLabel="#{year}"/>
                                    </p:selectOneMenu>

                                    <p:outputLabel for="cvc" value="CVC code"/>
                                    <p:inputMask id="cvc"
                                                 mask="999"
                                                 required="true"
                                                 style="max-width: 30px;"/>

                                </p:panelGrid>
                            </p:panel>
                            <p:panel header="Cardholder information">
                                <p:panelGrid columns="2" cellPadding="5">
                                    <p:outputLabel for="firstName" value="First name: "/>
                                    <p:inputText id="firstName" value="#{flowBean.firstName}"/>

                                    <p:outputLabel for="lastName" value="Last name: "/>
                                    <p:inputText id="lastName" value="#{flowBean.lastName}"/>

                                    <p:outputLabel for="address" value="Address: "/>
                                    <p:inputText id="address" value="#{flowBean.address}"/>

                                    <p:outputLabel for="city" value="City: "/>
                                    <p:inputText id="city" value="#{flowBean.city}"/>

                                    <p:outputLabel for="zip" value="Zip/Postal code: "/>
                                    <p:inputText id="zip" value="#{flowBean.zip}"/>

                                    <p:outputLabel for="country" value="Country: "/>
                                    <p:inputText id="country" value="#{flowBean.country}"/>

                                </p:panelGrid>
                            </p:panel>
                        </div>
                    </p:panel>
                </p:tab>

                <p:tab id="confirmation" title="Confirmation">
                    <p:panel>
                        <div style="max-width: 60%; margin: 10px auto;">
                            <p:panel header="Please confirm your order">
                                <h:outputText value="Billing address:" class="titleColumn"/><br/>
                                <div class="p-grid">
                                    <div class="p-col-6 p-offset-3">
                                        <div>#{flowBean.firstName} #{flowBean.lastName}</div>
                                        <div>#{flowBean.address}</div>
                                        <div>#{flowBean.city}</div>
                                        <div>#{flowBean.country}</div>
                                    </div>
                                </div>
                                <br/>
                                <h:outputText value="Number of different articles: "/>
                                <h:outputText value="#{orderController.currentOrder.numberOfDifferentArticles}"/><br/>
                                <h:outputText value="Total number of  articles: "/>
                                <h:outputText value="#{orderController.currentOrder.totalNumberOfArticles}"/>
                                <p:dataTable value="#{orderController.currentOrder.orderLines}"
                                             var="line" class="orderDetailsTable">
                                    <p:column headerText="Article Id">
                                        <h:outputText value="#{line.id}"/>
                                    </p:column>

                                    <p:column headerText="Title">
                                        <h:outputText value="#{line.article.title}"/>
                                    </p:column>

                                    <p:column headerText="Unit price">
                                        <h:outputText value="#{line.article.price}"/>
                                    </p:column>

                                    <p:column headerText="Amount">
                                        <h:outputText value="#{line.amount}"/>
                                    </p:column>

                                    <p:column headerText="Subtotal">
                                        <h:outputText value="#{line.subTotal}"/>
                                    </p:column>
                                </p:dataTable>

                                <div class="ui-g-6">Total price</div>
                                <div class="ui-g-5 rightAlign titleColumn">
                                    <h:outputText value="#{orderController.currentOrder.price}">
                                        <f:convertNumber pattern="0.00 €"/>
                                    </h:outputText>
                                </div>
                                <div class="ui-g-1"></div>

                            </p:panel>
                            <p:commandButton value="Submit" action="#{orderController.submit}"/>
                        </div>
                    </p:panel>
                </p:tab>

            </p:wizard>
        </h:form>
    </ui:define>
</ui:composition>
</html>